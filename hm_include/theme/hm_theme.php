<?php/** * Class này xử lý giao diện của website */if ( ! defined('BASEPATH')) exit('403');Class theme extends MySQL{		public $hmtaxonomy = array();		/** Lấy thông tin giao diện đang được kích hoạt */	public function activated_theme(){				$tableName=DB_PREFIX."option";		$whereArray=array(				'section'=>MySQL::SQLValue('system_setting'),				'key'=>MySQL::SQLValue('theme'),		);		$this->SelectRows($tableName, $whereArray);		if( $this->HasRecords() ){									$row = $this->Row();			return $row->value;								}else{						if(file_exists(BASEPATH . HM_THEME_DIR . '/' . DEFAULT_THEME . '/init.php')){				return DEFAULT_THEME;			}else{				return FALSE;			}					}		}			/** Load file template dựa trên theme và request */	public function load_theme($args){				$theme = $args['theme'];		$request = $args['request'];		$request = urldecode($request);				if($request){							$tableName=DB_PREFIX."request_uri";						$whereArray=array(				'uri'=>MySQL::SQLValue($request),			);			$this->SelectRows($tableName, $whereArray);						if( $this->HasRecords() ){								$row = $this->Row();				$template_file = $row->object_type;				$data['id'] = $row->object_id;				$this->load_template_file($theme,$template_file,$data);							}else{								$this->load_template_file($theme,'404');							}				}else{						$this->load_template_file($theme,'index');					}			}		/** Load file template giao diện đang dùng */	public function get_template_part($template_file){				$theme = $this->activated_theme(); 		$this->load_template_file($theme,$template_file);			}		/** Load file template dựa trên tên file php */	public function load_template_file($theme,$template_file,$data = array()){				foreach ($data as $key => $value){			$$key = $value;		}				if(file_exists(BASEPATH . HM_THEME_DIR . '/'.$theme.'/'.$template_file.'.php')){					require_once(BASEPATH . HM_THEME_DIR . '/'.$theme.'/'.$template_file.'.php');				}else{						hm_exit('Không thể load file "'.$template_file.'.php" của giao diện "'.$theme.'"');					}			}		}